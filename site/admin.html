<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=1280">
  <script src="config.js"></script>
  <title>–ê–¥–º–∏–Ω‚Äë–ø–∞–Ω–µ–ª—å | Bike App</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css?v=7.4">
  <link rel="stylesheet" href="blend.css">
  <link rel="stylesheet" href="admin.css">
  <style>
    #tariff-form .form-group {
      margin-bottom: 15px;
    }

    #tariff-form textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--progress-bar-bg);
      border-radius: 8px;
      font-size: 0.95rem;
      resize: vertical;
      min-height: 80px;
    }

    #tariff-form input[type="text"],
    #tariff-form input[type="number"] {
      margin-bottom: 0;
    }

    /* Map container styles */
    #admin-map-container {
      width: 100%;
      height: 650px;
      /* Fixed pixel height for Yandex Maps compatibility */
      border-radius: 16px;
      overflow: hidden;
      border: 1px solid var(--border);
    }

    /* –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–æ –ø—Ä—è—á–µ–º –≤—Å–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç */
    [class*="copyrights-pane"],
    [class*="search__control"],
    [class*="gotoymaps"],
    .ymaps-2-1-79-controls__control_toolbar,
    .ymaps-2-1-79-map-copyrights-promo,
    .ymaps-2-1-79-copyright {
      display: none !important;
    }

    /* Search results dropdown */
    .search-results-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border: 1px solid var(--border);
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      max-height: 200px;
      overflow-y: auto;
      z-index: 1000;
    }

    .search-result-item {
      padding: 8px 12px;
      cursor: pointer;
      border-bottom: 1px solid var(--progress-bar-bg);
      transition: background-color 0.2s;
    }

    .search-result-item:hover,
    .search-result-item.active {
      background-color: var(--primary-color-light, #f0f8ff);
    }

    .search-result-item:last-child {
      border-bottom: none;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.41.0/dist/umd/supabase.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/@tiptap/starter-kit@2.0.0-beta.183/dist/index.global.js"></script>
  <!-- Yandex Maps API -->
  <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU&apikey=a32fae3e-06f9-4231-87a0-f225b5d7a04a"></script>
  <script src="transitions.js" defer></script>
</head>

<body>
  <div id="admin-app">
    <!-- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ (–≤—ã–Ω–µ—Å–µ–Ω—ã –∏–∑ —Å–µ–∫—Ü–∏–π –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è) -->


    <!-- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è -->
    <div id="login-section">
      <h2>–í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω‚Äë–ø–∞–Ω–µ–ª—å</h2>
      <form id="login-form">
        <input type="email" id="login-email" placeholder="Email" required>
        <input type="password" id="login-password" placeholder="–ü–∞—Ä–æ–ª—å" required>
        <button type="submit">–í–æ–π—Ç–∏</button>
      </form>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å -->
    <div id="dashboard-section" class="hidden">

      <!-- Assignments -->
      <nav id="admin-nav">
        <button type="button" data-section="dashboard-main" class="active">Dashboard</button>
        <button type="button" data-section="assignments">–ó–∞—è–≤–∫–∏</button>
        <button type="button" data-section="bookings">–ë—Ä–æ–Ω–∏</button>
        <button type="button" data-section="tariffs">–¢–∞—Ä–∏—Ñ—ã</button>
        <button type="button" data-section="clients">–ö–ª–∏–µ–Ω—Ç—ã</button>
        <button type="button" data-section="rentals">–ê—Ä–µ–Ω–¥—ã</button>
        <button type="button" data-section="payments">–ü–ª–∞—Ç–µ–∂–∏</button>
        <button type="button" data-section="bikes">–í–µ–ª–æ—Å–∏–ø–µ–¥—ã</button>
        <button type="button" data-section="batteries">–ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä—ã</button>
        <button type="button" data-section="templates">–®–∞–±–ª–æ–Ω—ã</button>
        <button type="button" data-section="admin-map">–ö–∞—Ä—Ç–∞</button>
        <a href="admin_support.html" class="admin-nav-link-button">
          <button type="button">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</button>
        </a>
      </nav>

      <!-- Sections Container for Smooth Transitions -->
      <div class="admin-sections-container">
        <!-- Dashboard -->
        <section id="dashboard-main-section" class="admin-section">
          <div class="section-header">
            <h2>–ü–∞–Ω–µ–ª—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</h2>
          </div>

          <div class="info-cards" id="dashboard-metrics">
            <!-- Bike stats will be loaded here by JS -->
          </div>

          <h3 style="margin-top: 30px;">–î–æ—Ö–æ–¥ –ø–æ –¥–Ω—è–º, ‚ÇΩ</h3>
          <div class="chart-container" style="margin-top: 20px;">
            <canvas id="payments-chart"></canvas>
          </div>
          <h3 style="margin-top: 30px;">–î–æ—Ö–æ–¥ –∑–∞ –Ω–µ–¥–µ–ª—é</h3>
          <div id="weekly-income" style="margin-top: 20px; font-size: 1.2rem; font-weight: 600;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </section>

        <!-- Assignments -->
        <section id="assignments-section" class="admin-section hidden">
          <div class="section-header">
            <h2>–ó–∞—è–≤–∫–∏ –Ω–∞ –∞—Ä–µ–Ω–¥—É</h2>
            <div class="section-toolbar">
              <input type="search" id="assignment-search" class="toolbar-input"
                placeholder="–ü–æ–∏—Å–∫ –ø–æ –∫–ª–∏–µ–Ω—Ç—É –∏–ª–∏ —Ç–∞—Ä–∏—Ñ—É">
            </div>
          </div>
          <table id="assignments-table" class="admin-table">
            <thead>
              <tr>
                <th>–ö–ª–∏–µ–Ω—Ç</th>
                <th>–¢–∞—Ä–∏—Ñ</th>
                <th>–¢–∏–ø</th>
                <th>–î–∞—Ç–∞ –∑–∞—è–≤–∫–∏</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </section>

        <!-- Bookings -->
        <section id="bookings-section" class="admin-section hidden">
          <div class="section-header">
            <h2>–ê–∫—Ç–∏–≤–Ω—ã–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
            <button type="button" id="setup-booking-cost-btn" class="btn btn-secondary">–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å</button>
          </div>
          <table id="bookings-table" class="admin-table table-wide-actions">
            <thead>
              <tr>
                <th>–ö–ª–∏–µ–Ω—Ç</th>
                <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                <th>–ë—Ä–æ–Ω—å –∏—Å—Ç–µ–∫–∞–µ—Ç</th>
                <th>–ü—Ä–æ–≥—Ä–µ—Å—Å</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
              </tr>
            </thead>
            <tbody>
              <!-- –°—é–¥–∞ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –¥–∞–Ω–Ω—ã–µ -->
            </tbody>
          </table>
        </section>

        <!-- –¢–∞—Ä–∏—Ñ—ã -->
        <section id="tariffs-section" class="admin-section hidden">
          <div class="section-header">
            <h2>–¢–∞—Ä–∏—Ñ—ã</h2>
            <div class="section-toolbar">
              <button type="button" id="tariff-add-btn" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å —Ç–∞—Ä–∏—Ñ</button>
            </div>
          </div>

          <table id="tariffs-table" class="admin-table">
            <thead>
              <tr>
                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                <th>–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</th>
                <th>–ü—Ä–æ–¥–ª–µ–Ω–∏—è (–¥–Ω./‚ÇΩ)</th>
                <th>–ê–∫—Ç–∏–≤–µ–Ω</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>

          <h3 id="tariff-form-title">–ù–æ–≤—ã–π —Ç–∞—Ä–∏—Ñ</h3>
          <form id="tariff-form">
            <input type="hidden" id="tariff-id">
            <div class="form-group">
              <label for="tariff-title">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞</label>
              <input type="text" id="tariff-title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞" required>
            </div>
            <div class="form-group">
              <label for="tariff-short-description">–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (–¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–∞—Ä–∏—Ñ–∞)</label>
              <textarea id="tariff-short-description" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –¥–æ–ª–≥–∏—Ö –ø–æ–µ–∑–¥–æ–∫ –ø–æ –≥–æ—Ä–æ–¥—É"
                rows="2"></textarea>
            </div>
            <div class="form-group">
              <label for="tariff-description">–ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (–¥–ª—è –¥–æ–≥–æ–≤–æ—Ä–∞)</label>
              <textarea id="tariff-description"
                placeholder="–ü–æ–ª–Ω–æ–µ —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω–æ –≤ –¥–æ–≥–æ–≤–æ—Ä" rows="4"></textarea>
            </div>
            <div class="form-group">
              <label class="checkbox-label"><input type="checkbox" id="tariff-active" checked> –ê–∫—Ç–∏–≤–µ–Ω</label>
            </div>

            <div class="form-group">
              <label for="contract-template-select">–®–∞–±–ª–æ–Ω –¥–æ–≥–æ–≤–æ—Ä–∞:</label>
              <select id="contract-template-select">
                <option value="">‚Äî –ù–µ –≤—ã–±—Ä–∞–Ω ‚Äî</option>
              </select>
            </div>

            <div class="form-group">
              <div id="tariff-extensions-container" class="tariff-extensions-container">
                <label>–°—Ç–æ–∏–º–æ—Å—Ç—å –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ - –æ—Å–Ω–æ–≤–Ω–∞—è):</label>
                <div id="extensions-list" class="extensions-list"></div>
                <button type="button" id="add-extension-btn" class="admin-small-btn">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥–ª–µ–Ω–∏–µ</button>
              </div>
            </div>

            <div class="form-actions">
              <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
              <button type="button" id="tariff-cancel-btn" class="hidden">–û—Ç–º–µ–Ω–∞</button>
            </div>
          </form>
        </section>

        <!-- –®–∞–±–ª–æ–Ω—ã –¥–æ–≥–æ–≤–æ—Ä–æ–≤ -->
        <section id="templates-section" class="admin-section hidden">
          <div class="section-header">
            <h2>–®–∞–±–ª–æ–Ω—ã –¥–æ–≥–æ–≤–æ—Ä–æ–≤</h2>
            <div class="section-toolbar">
              <button type="button" id="template-new-btn" class="btn btn-secondary">–ù–æ–≤—ã–π —à–∞–±–ª–æ–Ω</button>
              <button type="button" id="template-preview-btn" class="btn">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</button>
              <button type="button" id="template-save-btn" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
          </div>
          <div class="templates-wrapper">
            <div class="templates-list">
              <table id="templates-table" class="admin-table">
                <thead>
                  <tr>
                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                    <th>–ê–∫—Ç–∏–≤–µ–Ω</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
            <div class="template-editor-panel">
              <div class="template-form">
                <input type="hidden" id="template-id">
                <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                <input type="text" id="template-name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –î–æ–≥–æ–≤–æ—Ä –∞—Ä–µ–Ω–¥—ã (RU)">
                <label class="checkbox-label" style="margin-top:10px"><input type="checkbox" id="template-active"
                    checked> –ê–∫—Ç–∏–≤–µ–Ω</label>
              </div>

              <div class="placeholder-palette">
                <div class="palette-group">
                  <strong>–ö–ª–∏–µ–Ω—Ç</strong>
                  <div class="chips" id="chips-client"></div>
                </div>
                <div class="palette-group">
                  <strong>–¢–∞—Ä–∏—Ñ</strong>
                  <div class="chips" id="chips-tariff"></div>
                </div>
                <div class="palette-group">
                  <strong>–ê—Ä–µ–Ω–¥–∞</strong>
                  <div class="chips" id="chips-rental"></div>
                </div>
                <div class="palette-group">
                  <strong>–°–ª—É–∂–µ–±–Ω—ã–µ</strong>
                  <div class="chips" id="chips-aux"></div>
                </div>
              </div>

              <div class="editor-toolbar">
                <button type="button" data-cmd="bold"><b>B</b></button>
                <button type="button" data-cmd="italic"><i>I</i></button>
                <button type="button" data-cmd="underline"><u>U</u></button>
                <button type="button" data-cmd="insertParagraph">¬∂</button>
              </div>
              <div id="template-editor" class="template-editor"></div>
              <p class="hint">–ü–æ–¥—Å–∫–∞–∑–∫–∞: –∫–ª–∏–∫–∞–π—Ç–µ –Ω–∞ —á–∏–ø—Å—ã, —á—Ç–æ–±—ã –≤—Å—Ç–∞–≤–∏—Ç—å –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä
                <code>{{client.full_name}}</code>) –≤ –ø–æ–∑–∏—Ü–∏—é –∫—É—Ä—Å–æ—Ä–∞.
              </p>
            </div>
          </div>
        </section>

        <!-- –ö–ª–∏–µ–Ω—Ç—ã -->
        <section id="clients-section" class="admin-section hidden">
          <div class="section-header">
            <h2>–ö–ª–∏–µ–Ω—Ç—ã</h2>
            <div class="section-toolbar">
              <input type="search" id="client-search" class="toolbar-input"
                placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏, —Ç–µ–ª–µ—Ñ–æ–Ω—É –∏–ª–∏ –≥–æ—Ä–æ–¥—É">
              <button id="export-clients-btn" class="btn btn-secondary">–≠–∫—Å–ø–æ—Ä—Ç CSV</button>
            </div>
          </div>

          <table id="clients-table" class="admin-table">
            <thead>
              <tr>
                <th>–ò–º—è</th>
                <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–¢–µ–≥–∏</th>
                <th>–°–æ–∑–¥–∞–Ω</th>
                <th>–ü—Ä–æ—Å–º–æ—Ç—Ä</th>
                <th>–í–µ—Ä.</th>
                <th>–î–µ–π—Å—Ç.</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </section>

        <!-- –ê—Ä–µ–Ω–¥—ã -->
        <section id="rentals-section" class="admin-section hidden">
          <div class="section-header">
            <h2>–ê—Ä–µ–Ω–¥—ã</h2>
          </div>
          <table id="rentals-table" class="admin-table table-wide-actions">
            <thead>
              <tr>
                <th>–ö–ª–∏–µ–Ω—Ç</th>
                <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                <th>–í–µ–ª–æ—Å–∏–ø–µ–¥</th>
                <th>–ù–∞—á–∞–ª–æ</th>
                <th>–ö–æ–Ω–µ—Ü</th>
                <th>–°—É–º–º–∞</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </section>

        <!-- –ü–ª–∞—Ç–µ–∂–∏ -->
        <section id="payments-section" class="admin-section hidden">
          <div class="section-header">
            <h2>–ü–ª–∞—Ç–µ–∂–∏</h2>
            <div class="section-toolbar">
              <input type="search" id="payment-search" class="toolbar-input"
                placeholder="–ü–æ–∏—Å–∫ –ø–æ –∫–ª–∏–µ–Ω—Ç—É, —Å—É–º–º–µ –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏—é">
            </div>
          </div>
          <table id="payments-table" class="admin-table">
            <thead>
              <tr>
                <th>–ö–ª–∏–µ–Ω—Ç</th>
                <th>–°—É–º–º–∞</th>
                <th>–¢–∏–ø –ø–ª–∞—Ç–µ–∂–∞</th>
                <th>–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–î–∞—Ç–∞</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </section>

        <!-- –í–µ–ª–æ—Å–∏–ø–µ–¥—ã -->
        <section id="bikes-section" class="admin-section hidden">
          <div class="section-header">
            <h2>–í–µ–ª–æ—Å–∏–ø–µ–¥—ã</h2>
            <div class="section-toolbar">
              <input type="search" id="bike-search" class="toolbar-input"
                placeholder="–ü–æ–∏—Å–∫ –ø–æ –∫–æ–¥—É, –º–æ–¥–µ–ª–∏ –∏–ª–∏ –≥–æ—Ä–æ–¥—É">
              <button type="button" id="bike-add-btn" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å –≤–µ–ª–æ—Å–∏–ø–µ–¥</button>
            </div>
          </div>

          <table id="bikes-table" class="admin-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>–ö–æ–¥</th>
                <th>–ú–æ–¥–µ–ª—å</th>
                <th>–ì–æ—Ä–æ–¥</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–†–µ–º–æ–Ω—Ç</th> <!-- <-- –ù–û–í–ê–Ø –ö–û–õ–û–ù–ö–ê -->
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>

          <h3 id="bike-form-title" class="hidden" style="margin-top: 30px;">–ù–æ–≤—ã–π –≤–µ–ª–æ—Å–∏–ø–µ–¥</h3>
          <form id="bike-form" class="hidden">
            <input type="hidden" id="bike-id">
            <div class="form-group">
              <label for="bike-code">–ö–æ–¥ –≤–µ–ª–æ—Å–∏–ø–µ–¥–∞ (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π)</label>
              <input type="text" id="bike-code" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 00004" required>
            </div>
            <div class="form-group">
              <label for="bike-model">–ú–æ–¥–µ–ª—å</label>
              <input type="text" id="bike-model" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Trek FX 2" required>
            </div>
            <div class="form-group">
              <label for="bike-city">–ì–æ—Ä–æ–¥</label>
              <select id="bike-city" class="form-control" required>
                <option value="–í–æ—Ä–æ–Ω–µ–∂">–í–æ—Ä–æ–Ω–µ–∂</option>
              </select>
            </div>
            <div class="form-group">
              <label for="bike-status">–°—Ç–∞—Ç—É—Å</label>
              <select id="bike-status" class="form-control" required>
                <option value="available">–°–≤–æ–±–æ–¥–µ–Ω</option>
                <option value="rented">–í –∞—Ä–µ–Ω–¥–µ</option>
                <option value="reserved">–ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω</option>
                <option value="in_service">–ù–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏</option>
                <option value="maintenance">–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ</option>
                <option value="out_of_order">–ù–µ–∏—Å–ø—Ä–∞–≤–µ–Ω</option>
                <option value="unavailable">–ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω</option>
              </select>
            </div>

            <!-- –ù–û–í–´–ô –ë–õ–û–ö: –í–´–ë–û–† –¢–ê–†–ò–§–ê -->
            <div class="form-group">
              <label for="bike-tariff-select">–¢–∞—Ä–∏—Ñ</label>
              <select id="bike-tariff-select" class="form-control">
                <option value="">-- –ù–µ –≤—ã–±—Ä–∞–Ω --</option>
                <!-- –û–ø—Ü–∏–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
              </select>
            </div>

            <div class="form-group">
              <label for="bike-frame-number">–ù–æ–º–µ—Ä —Ä–∞–º—ã</label>
              <input type="text" id="bike-frame-number" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: FR123456">
            </div>
            <div class="form-group">
              <label for="bike-battery-numbers">–ù–æ–º–µ—Ä–∞ –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä–æ–≤ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
              <input type="text" id="bike-battery-numbers" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: BAT001, BAT002">
            </div>
            <div class="form-group">
              <label for="bike-registration-number">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –Ω–æ–º–µ—Ä</label>
              <input type="text" id="bike-registration-number" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ê123–ë–í77">
            </div>
            <div class="form-group">
              <label for="bike-iot-device-id">–ù–æ–º–µ—Ä IOT-—Ç—Ä–µ–∫–µ—Ä–∞</label>
              <input type="text" id="bike-iot-device-id" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: IOT987654">
            </div>
            <div class="form-group">
              <label for="bike-additional-equipment">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</label>
              <textarea id="bike-additional-equipment" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ó–∞–º–æ–∫, –¥–µ—Ä–∂–∞—Ç–µ–ª—å –¥–ª—è –±—É—Ç—ã–ª–∫–∏"
                rows="3"></textarea>
            </div>

            <div class="form-actions">
              <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
              <button type="button" id="bike-cancel-btn">–û—Ç–º–µ–Ω–∞</button>
            </div>
          </form>
        </section>

        <!-- –ö–∞—Ä—Ç–∞ –≤–µ–ª–æ—Å–∏–ø–µ–¥–æ–≤ -->
        <section id="admin-map-section" class="admin-section hidden">
          <div class="section-header">
            <h2>–ö–∞—Ä—Ç–∞ –≤–µ–ª–æ—Å–∏–ø–µ–¥–æ–≤</h2>
            <div class="section-toolbar">
              <input type="text" id="courier-search-input" class="form-control" placeholder="–ù–∞–π—Ç–∏ –∫—É—Ä—å–µ—Ä–∞ –ø–æ –∏–º–µ–Ω–∏..."
                style="width: 250px;" autocomplete="off">
              <div id="courier-search-results" class="search-results-dropdown" style="display: none;"></div>
            </div>
          </div>
          <div id="admin-map-container"></div>
        </section>

        <!-- –ù–û–í–ê–Ø –°–ï–ö–¶–ò–Ø: –ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä—ã -->
        <section id="batteries-section" class="admin-section hidden">
          <div class="section-header">
            <h2>–ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä—ã</h2>
            <div class="section-toolbar">
              <input type="search" id="battery-search" class="toolbar-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏—é">
              <button type="button" id="battery-add-btn" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä</button>
            </div>
          </div>

          <table id="batteries-table" class="admin-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä</th>
                <th>–ú–æ—â–Ω–æ—Å—Ç—å (Wh)</th>
                <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>

          <h3 id="battery-form-title" class="hidden" style="margin-top: 30px;">–ù–æ–≤—ã–π –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä</h3>
          <form id="battery-form" class="hidden">
            <input type="hidden" id="battery-id">
            <div class="form-group">
              <label for="battery-serial-number">–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π)</label>
              <input type="text" id="battery-serial-number" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ê–ö–ë-001" required>
            </div>
            <div class="form-group">
              <label for="battery-capacity">–ú–æ—â–Ω–æ—Å—Ç—å (–í–∞—Ç—Ç-—á–∞—Å—ã)</label>
              <input type="number" id="battery-capacity" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 1000">
            </div>
            <div class="form-group">
              <label for="battery-description">–û–ø–∏—Å–∞–Ω–∏–µ</label>
              <textarea id="battery-description" placeholder="–õ—é–±—ã–µ –∑–∞–º–µ—Ç–∫–∏" rows="2"></textarea>
            </div>
            <div class="form-group">
              <label for="battery-status">–°—Ç–∞—Ç—É—Å</label>
              <select id="battery-status" class="form-control" required>
                <option value="available">–°–≤–æ–±–æ–¥–µ–Ω</option>
                <option value="in_use">–í –∞—Ä–µ–Ω–¥–µ</option>
                <option value="charging">–ù–∞ –∑–∞—Ä—è–¥–∫–µ</option>
                <option value="maintenance">–ù–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏</option>
              </select>
            </div>
            <div class="form-actions">
              <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
              <button type="button" id="battery-cancel-btn">–û—Ç–º–µ–Ω–∞</button>
            </div>
          </form>
        </section>


      </div> <!-- End admin-sections-container -->
    </div>
  </div>

  <script>
    // –£–¥–æ–±—Å—Ç–≤–æ: –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ —Ñ–æ—Ä–º–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–∞—Ä–∏—Ñ–∞
    document.addEventListener('DOMContentLoaded', () => {
      const addBtn = document.getElementById('tariff-add-btn');
      const formTitle = document.getElementById('tariff-form-title');
      if (addBtn && formTitle) {
        addBtn.addEventListener('click', () => {
          formTitle.scrollIntoView({ behavior: 'smooth', block: 'start' });
        });
      }

      // –ü–æ–∏—Å–∫ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ (UI)
      const search = document.getElementById('client-search');
      const clientsTable = document.getElementById('clients-table');
      const tbody = clientsTable ? clientsTable.querySelector('tbody') : null;
      if (search && tbody) {
        search.addEventListener('input', () => {
          const q = search.value.toLowerCase();
          tbody.querySelectorAll('tr').forEach(tr => {
            tr.style.display = tr.textContent.toLowerCase().includes(q) ? '' : 'none';
          });
        });
      }

      // –ü–æ–∏—Å–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ –∑–∞—è–≤–æ–∫ (assignments)
      const assignmentSearch = document.getElementById('assignment-search');
      const assignmentsTable = document.getElementById('assignments-table');
      const assignmentsTbody = assignmentsTable ? assignmentsTable.querySelector('tbody') : null;
      if (assignmentSearch && assignmentsTbody) {
        assignmentSearch.addEventListener('input', () => {
          const q = assignmentSearch.value.toLowerCase();
          assignmentsTbody.querySelectorAll('tr').forEach(tr => {
            tr.style.display = tr.textContent.toLowerCase().includes(q) ? '' : 'none';
          });
        });
      }

      // –ü–æ–∏—Å–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ –ø–ª–∞—Ç–µ–∂–µ–π (payments)
      const paymentSearch = document.getElementById('payment-search');
      const paymentsTable = document.getElementById('payments-table');
      const paymentsTbody = paymentsTable ? paymentsTable.querySelector('tbody') : null;
      if (paymentSearch && paymentsTbody) {
        paymentSearch.addEventListener('input', () => {
          const q = paymentSearch.value.toLowerCase();
          paymentsTbody.querySelectorAll('tr').forEach(tr => {
            tr.style.display = tr.textContent.toLowerCase().includes(q) ? '' : 'none';
          });
        });
      }

      // –ü–æ–∏—Å–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ –≤–µ–ª–æ—Å–∏–ø–µ–¥–æ–≤ (bikes)
      const bikeSearch = document.getElementById('bike-search');
      const bikesTable = document.getElementById('bikes-table');
      const bikesTbody = bikesTable ? bikesTable.querySelector('tbody') : null;
      if (bikeSearch && bikesTbody) {
        bikeSearch.addEventListener('input', () => {
          const q = bikeSearch.value.toLowerCase();
          bikesTbody.querySelectorAll('tr').forEach(tr => {
            tr.style.display = tr.textContent.toLowerCase().includes(q) ? '' : 'none';
          });
        });
      }
      if (clientsTable && tbody) {
        let dir = 1; // 1 asc, -1 desc
        clientsTable.querySelector('thead')?.addEventListener('click', (e) => {
          const th = e.target.closest('th');
          if (!th) return;
          const idx = Array.from(th.parentElement.children).indexOf(th);
          const rows = Array.from(tbody.querySelectorAll('tr'));
          rows.sort((a, b) => {
            const ta = a.children[idx]?.textContent?.trim() || '';
            const tb = b.children[idx]?.textContent?.trim() || '';
            const na = parseFloat(ta.replace(/[^0-9.]/g, ''));
            const nb = parseFloat(tb.replace(/[^0-9.]/g, ''));
            let cmp = (!isNaN(na) && !isNaN(nb) && /^\d/.test(ta)) ? (na - nb) : ta.localeCompare(tb, 'ru');
            return cmp * dir;
          });
          dir *= -1;
          tbody.innerHTML = '';
          rows.forEach(r => tbody.appendChild(r));
        });
      }
    });
  </script>
  <script src="admin.js" defer></script>
  <!-- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ (–≤—ã–Ω–µ—Å–µ–Ω—ã –∏–∑ —Å–µ–∫—Ü–∏–π –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è) -->
  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞—Ä–µ–Ω–¥—ã -->
  <div id="rental-edit-modal" class="overlay hidden">
    <div class="modal" style="max-width: 500px;">
      <div class="modal-header">
        <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Ä–µ–Ω–¥—ã</h3>
        <button id="rental-edit-cancel-btn" class="close-btn">&times;</button>
      </div>
      <div class="modal-body">
        <form id="rental-edit-form">
          <input type="hidden" id="rental-edit-id">

          <div class="form-group">
            <label for="rental-edit-bike">–í–µ–ª–æ—Å–∏–ø–µ–¥</label>
            <select id="rental-edit-bike" class="form-control"></select>
          </div>

          <div class="form-group">
            <label for="rental-edit-end-date">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</label>
            <input type="datetime-local" id="rental-edit-end-date" class="form-control">
          </div>

          <div class="form-group">
            <label for="rental-edit-status">–°—Ç–∞—Ç—É—Å</label>
            <select id="rental-edit-status" class="form-control">
              <option value="awaiting_contract_signing">–û–∂–∏–¥–∞–µ—Ç –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è</option>
              <option value="active">–ê–∫—Ç–∏–≤–Ω–∞</option>
              <option value="completed">–ó–∞–≤–µ—Ä—à–µ–Ω–∞</option>
              <option value="completed_by_admin">–ó–∞–≤–µ—Ä—à–µ–Ω–æ –∞–¥–º–∏–Ω–æ–º</option>
              <option value="rejected">–û—Ç–∫–ª–æ–Ω–µ–Ω–∞</option>
            </select>
          </div>

        </form>
      </div>
      <div class="modal-footer">
        <button type="button" id="rental-edit-save-btn" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <!-- New Modal for Return Processing (Step-by-Step) -->
  <div id="return-process-modal" class="overlay hidden">
    <div class="modal" style="max-width: 650px;">
      <div class="modal-header">
        <h3 id="return-modal-title">–ü—Ä–∏–µ–º–∫–∞ –≤–µ–ª–æ—Å–∏–ø–µ–¥–∞</h3>
        <button id="return-process-close-btn" class="close-btn">&times;</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="return-process-rental-id">
        
        <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ -->
        <div style="display: flex; justify-content: space-between; margin-bottom: 25px; position: relative;">
          <div style="position: absolute; top: 15px; left: 0; right: 0; height: 2px; background: #e0e0e0; z-index: 0;"></div>
          <div class="step-indicator" data-step="1">
            <div class="step-circle active">1</div>
            <div class="step-label">–°—Ç–∞—Ç—É—Å –≤–µ–ª–æ—Å–∏–ø–µ–¥–∞</div>
          </div>
          <div class="step-indicator" data-step="2">
            <div class="step-circle">2</div>
            <div class="step-label">–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏</div>
          </div>
          <div class="step-indicator" data-step="3">
            <div class="step-circle">3</div>
            <div class="step-label">–°—á–µ—Ç –∑–∞ —É—â–µ—Ä–±</div>
          </div>
        </div>

        <!-- –®–∞–≥ 1: –í—ã–±–æ—Ä —Å—Ç–∞—Ç—É—Å–∞ –≤–µ–ª–æ—Å–∏–ø–µ–¥–∞ -->
        <div id="return-step-1" class="return-step">
          <h4 style="margin-bottom: 15px;">–ö—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤–µ–ª–æ—Å–∏–ø–µ–¥?</h4>
          <div class="form-group">
            <div style="display: flex; flex-direction: column; gap: 12px;">
              <label class="radio-card">
                <input type="radio" name="bike-next-status" value="available" checked>
                <div class="radio-card-content">
                  <strong>‚úÖ –í —Å–≤–æ–±–æ–¥–Ω—ã–µ</strong>
                  <span>–í–µ–ª–æ—Å–∏–ø–µ–¥ –≤ —Ö–æ—Ä–æ—à–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏, –≥–æ—Ç–æ–≤ –∫ –∞—Ä–µ–Ω–¥–µ</span>
                </div>
              </label>
              <label class="radio-card">
                <input type="radio" name="bike-next-status" value="in_service">
                <div class="radio-card-content">
                  <strong>üîß –í —Ä–µ–º–æ–Ω—Ç</strong>
                  <span>–¢—Ä–µ–±—É–µ—Ç—Å—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –∏–ª–∏ —Ä–µ–º–æ–Ω—Ç</span>
                </div>
              </label>
            </div>
          </div>
          <div class="form-group hidden" id="service-reason-group" style="margin-top: 15px;">
            <label for="service-reason">–ü—Ä–∏—á–∏–Ω–∞ —Ä–µ–º–æ–Ω—Ç–∞</label>
            <input type="text" id="service-reason" class="form-control" placeholder="–ü—Ä–∏–º–µ—Ä: –ó–∞–º–µ–Ω–∞ —Ç–æ—Ä–º–æ–∑–Ω—ã—Ö –∫–æ–ª–æ–¥–æ–∫">
          </div>
        </div>

        <!-- –®–∞–≥ 2: –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ -->
        <div id="return-step-2" class="return-step hidden">
          <h4 style="margin-bottom: 15px;">–í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏</h4>
          <div class="form-group">
            <label for="return-defects">–£–∫–∞–∂–∏—Ç–µ –≤—Å–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ (–∫–∞–∂–¥—ã–π —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)</label>
            <textarea id="return-defects" class="form-control" rows="6" placeholder="–ü—Ä–∏–º–µ—Ä:
–¶–∞—Ä–∞–ø–∏–Ω–∞ –Ω–∞ —Ä–∞–º–µ (–ª–µ–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞)
–°–ª–æ–º–∞–Ω –∑–≤–æ–Ω–æ–∫
–ü–æ—Ç–µ—Ä—Ç–æ—Å—Ç—å –Ω–∞ —Å–µ–¥–ª–µ"></textarea>
            <small style="color: #666; margin-top: 5px; display: block;">–≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –∞–∫—Ç –ø—Ä–∏–µ–º–∞-–ø–µ—Ä–µ–¥–∞—á–∏</small>
          </div>
        </div>

        <!-- –®–∞–≥ 3: –°—á–µ—Ç –∑–∞ —É—â–µ—Ä–± -->
        <div id="return-step-3" class="return-step hidden">
          <h4 style="margin-bottom: 15px;">–í—ã—Å—Ç–∞–≤–∏—Ç—å —Å—á–µ—Ç –∑–∞ —É—â–µ—Ä–±?</h4>
          <div class="form-group">
            <div style="display: flex; flex-direction: column; gap: 12px;">
              <label class="radio-card">
                <input type="radio" name="charge-damage" value="no" checked>
                <div class="radio-card-content">
                  <strong>‚ùå –ù–µ—Ç</strong>
                  <span>–ó–∞–≤–µ—Ä—à–∏—Ç—å –ø—Ä–∏–µ–º–∫—É –±–µ–∑ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç–∞</span>
                </div>
              </label>
              <label class="radio-card">
                <input type="radio" name="charge-damage" value="yes">
                <div class="radio-card-content">
                  <strong>üí∞ –î–∞, –≤—ã—Å—Ç–∞–≤–∏—Ç—å —Å—á–µ—Ç</strong>
                  <span>–°–ø–∏—Å–∞—Ç—å —Å—É–º–º—É –∑–∞ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è</span>
                </div>
              </label>
            </div>
          </div>
          <div class="form-group hidden" id="damage-amount-group" style="margin-top: 15px;">
            <label for="damage-amount">–°—É–º–º–∞ –∫ —Å–ø–∏—Å–∞–Ω–∏—é (‚ÇΩ)</label>
            <input type="number" id="damage-amount" class="form-control" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 5000" min="0" step="100">
            <label for="damage-description" style="margin-top: 10px;">–û–ø–∏—Å–∞–Ω–∏–µ</label>
            <input type="text" id="damage-description" class="form-control" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –†–µ–º–æ–Ω—Ç –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω–æ–π —Ä–∞–º—ã">
          </div>
        </div>

      </div>
      <div class="modal-footer">
        <button type="button" id="return-prev-btn" class="btn btn-secondary hidden">‚Üê –ù–∞–∑–∞–¥</button>
        <button type="button" id="return-next-btn" class="btn btn-primary">–î–∞–ª–µ–µ ‚Üí</button>
        <button type="button" id="finalize-return-btn" class="btn btn-primary hidden">–ó–∞–≤–µ—Ä—à–∏—Ç—å –ø—Ä–∏–µ–º–∫—É</button>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤—ã–±–æ—Ä–∞ –≤–µ–ª–æ—Å–∏–ø–µ–¥–∞ -->
  <div id="assign-bike-modal" class="overlay hidden">
    <div class="modal" style="max-width: 500px;">
      <div class="modal-header">
        <h3>–ü—Ä–∏–≤—è–∑–∞—Ç—å –≤–µ–ª–æ—Å–∏–ø–µ–¥ –∫ –∞—Ä–µ–Ω–¥–µ</h3>
        <button id="assign-bike-cancel-btn" class="close-btn">&times;</button>
      </div>
      <div class="modal-body">
        <form id="assign-bike-form">
          <input type="hidden" id="assign-rental-id">
          <div class="form-group">
            <label for="bike-select">–í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–±–æ–¥–Ω—ã–π –≤–µ–ª–æ—Å–∏–ø–µ–¥:</label>
            <select id="bike-select" class="form-control" required></select>
          </div>
          <div id="bike-details" style="display: none;">
            <h4>–î–∞–Ω–Ω—ã–µ –≤–µ–ª–æ—Å–∏–ø–µ–¥–∞</h4>
            <div class="form-group">
              <label for="assign-bike-frame-number">–ù–æ–º–µ—Ä —Ä–∞–º—ã</label>
              <input type="text" id="assign-bike-frame-number" class="modal-form-input">
            </div>
            <div class="form-group">
              <label for="assign-bike-battery-numbers">–ù–æ–º–µ—Ä–∞ –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä–æ–≤ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
              <input type="text" id="assign-bike-battery-numbers" class="modal-form-input">
            </div>
            <div class="form-group">
              <label for="assign-bike-registration-number">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –Ω–æ–º–µ—Ä</label>
              <input type="text" id="assign-bike-registration-number" class="modal-form-input">
            </div>
            <div class="form-group">
              <label for="assign-bike-iot-device-id">–ù–æ–º–µ—Ä IOT-—Ç—Ä–µ–∫–µ—Ä–∞</label>
              <input type="text" id="assign-bike-iot-device-id" class="modal-form-input">
            </div>
            <div class="form-group">
              <label for="assign-bike-additional-equipment">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</label>
              <textarea id="assign-bike-additional-equipment" class="modal-form-input" rows="3"></textarea>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" id="assign-bike-submit-btn" class="btn btn-primary">–ü—Ä–∏–≤—è–∑–∞—Ç—å –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∞—Ä–∏—Ñ–∞ -->
  <div id="tariff-preview-modal" class="overlay hidden">
    <div class="modal-content" style="max-width: 400px;">
      <button class="modal-close" id="tariff-preview-close-btn">&times;</button>
      <h2>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–∞—Ä–∏—Ñ–∞</h2>
      <div id="tariff-preview-content" class="tariff-preview-card">
        <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∫–∞—Ä—Ç–æ—á–∫–∞ -->
      </div>
    </div>
  </div>

  <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —à–∞–±–ª–æ–Ω–∞ -->
  <div id="template-preview-overlay" class="overlay hidden">
    <div class="modal" style="max-width: 900px;">
      <div class="modal-header">
        <h3>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –¥–æ–≥–æ–≤–æ—Ä–∞</h3>
        <button id="template-preview-close" class="close-btn">&times;</button>
      </div>
      <div class="modal-body">
        <div id="template-preview-content" class="preview-content"></div>
      </div>
    </div>
  </div>

  <!-- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö -->
  <div id="client-edit-overlay" class="overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞</h3>
        <button id="client-edit-cancel" class="close-btn">&times;</button>
      </div>
      <div class="modal-body">
        <form id="client-edit-form"></form>
      </div>
      <div class="modal-footer">
        <button type="button" id="client-edit-save" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>

      <!-- Toast Notifications Container -->
      <div id="toast-container" aria-live="polite" aria-atomic="true"></div>
    </div>
  </div>

  <!-- –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ —Ñ–æ—Ç–æ -->
  <div id="client-info-overlay" class="overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–µ</h3>
        <button id="client-info-close" class="close-btn">&times;</button>
      </div>
      <div class="modal-body" id="client-info-content">
        <h4>–†–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:</h4>
        <div id="recognized-data-container">
          <div id="recognized-display"></div>
          <form id="recognized-edit-form" class="hidden"></form>
        </div>

        <!-- Client Tags Section -->
        <h4 style="margin-top: 20px;">–¢–µ–≥–∏</h4>
        <div id="client-tags-container" style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 10px;">
          <!-- Tags will be loaded here -->
        </div>

        <h4 style="margin-top: 20px;">–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–æ—Ç–æ:</h4>
        <div id="photo-links" class="photo-grid"></div>

        <!-- NEW NOTES SECTION -->
        <h4 style="margin-top: 20px;">–ó–∞–º–µ—Ç–∫–∏ –æ –∫–ª–∏–µ–Ω—Ç–µ</h4>
        <div id="client-notes-list"
          style="margin-bottom: 15px; max-height: 200px; overflow-y: auto; background-color: var(--card-bg); border-radius: 12px; padding: 10px;">
          <!-- Notes will be loaded here -->
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" id="add-tag-footer-btn" class="btn btn-secondary">–î–æ–±–∞–≤–∏—Ç—å —Ç–µ–≥</button>
        <button type="button" id="add-note-footer-btn" class="btn btn-secondary">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É</button>
        <button type="button" id="invoice-create-btn" class="btn btn-primary">–í—ã—Å—Ç–∞–≤–∏—Ç—å —Å—á–µ—Ç</button>
        <button type="button" id="balance-adjust-btn" class="btn btn-secondary">–ò–∑–º–µ–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å</button>
        <button type="button" id="client-info-edit-toggle" class="btn btn-secondary">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
        <button type="button" id="client-info-save" class="btn btn-primary hidden">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button type="button" id="client-info-close-2" class="btn btn-secondary">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç–∞ -->
  <div id="invoice-modal" class="overlay hidden">
    <div class="modal" style="max-width: 420px;">
      <div class="modal-header">
        <h3>–í—ã—Å—Ç–∞–≤–∏—Ç—å —Å—á–µ—Ç</h3>
        <button id="invoice-cancel-btn" class="close-btn">&times;</button>
      </div>
      <div class="modal-body">
        <form id="invoice-form">
          <input type="hidden" id="invoice-client-id">
          <div class="form-group">
            <label for="invoice-amount">–°—É–º–º–∞ (‚ÇΩ)</label>
            <input type="number" id="invoice-amount" class="modal-form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 500" required>
          </div>
          <div class="form-group">
            <label for="invoice-description">–û–ø–∏—Å–∞–Ω–∏–µ —Å—á–µ—Ç–∞</label>
            <textarea id="invoice-description" class="modal-form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –®—Ç—Ä–∞—Ñ –∑–∞ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ"
              rows="3" required></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" id="invoice-submit-btn" class="btn btn-primary">–í—ã—Å—Ç–∞–≤–∏—Ç—å –∏ —Å–ø–∏—Å–∞—Ç—å</button>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –±–∞–ª–∞–Ω—Å–∞ -->
  <div id="balance-modal" class="overlay hidden">
    <div class="modal" style="max-width: 420px;">
      <div class="modal-header">
        <h3>–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –±–∞–ª–∞–Ω—Å–∞</h3>
        <button id="balance-cancel-btn" class="close-btn">&times;</button>
      </div>
      <div class="modal-body">
        <form id="balance-form">
          <input type="hidden" id="balance-client-id">
          <div class="form-group">
            <label for="balance-amount">–°—É–º–º–∞ (‚ÇΩ)</label>
            <p class="form-hint" style="font-size: 0.8rem; color: #6b6b6b; margin-top: -5px;">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ
              —á–∏—Å–ª–æ –¥–ª—è —Å–ø–∏—Å–∞–Ω–∏—è.</p>
            <input type="number" id="balance-amount" class="modal-form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 500 –∏–ª–∏ -100"
              required>
          </div>
          <div class="form-group">
            <label for="balance-reason">–ü—Ä–∏—á–∏–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏</label>
            <input type="text" id="balance-reason" class="modal-form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ë–æ–Ω—É—Å –∑–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç—å"
              required>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" id="balance-submit-btn" class="btn btn-primary">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <!-- –ü—Ä–æ—Å–º–æ—Ç—Ä —Ñ–æ—Ç–æ (—É–≤–µ–ª–∏—á–µ–Ω–∏–µ) -->
  <div id="image-viewer-overlay" class="overlay hidden">
    <div class="image-viewer">
      <button id="image-viewer-close" class="close-btn">&times;</button>
      <button id="image-viewer-prev" class="arrow prev" aria-label="–ü—Ä–µ–¥—ã–¥—É—â–µ–µ">&#10094;</button>
      <button id="image-viewer-next" class="arrow next" aria-label="–°–ª–µ–¥—É—é—â–µ–µ">&#10095;</button>
      <img id="image-viewer-img" alt="–§–æ—Ç–æ" />
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ -->
  <div id="refund-modal" class="overlay hidden">
    <div class="modal" style="max-width: 420px;">
      <div class="modal-header">
        <h3>–û—Ñ–æ—Ä–º–∏—Ç—å –≤–æ–∑–≤—Ä–∞—Ç</h3>
        <button id="refund-cancel-btn" class="close-btn">&times;</button>
      </div>
      <div class="modal-body">
        <form id="refund-form">
          <input type="hidden" id="refund-payment-id">
          <div class="form-group">
            <label for="refund-amount">–°—É–º–º–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ (‚ÇΩ)</label>
            <input type="number" id="refund-amount" class="modal-form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 100.50" required>
          </div>
          <div class="form-group">
            <label for="refund-reason">–ü—Ä–∏—á–∏–Ω–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
            <input type="text" id="refund-reason" class="modal-form-input"
              placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ù–µ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —É—Å–ª—É–≥–∞">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" id="refund-submit-btn" class="btn btn-primary">–í—ã–ø–æ–ª–Ω–∏—Ç—å –≤–æ–∑–≤—Ä–∞—Ç</button>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–µ—Ç–∞–ª–µ–π –ø–ª–∞—Ç–µ–∂–∞ -->
  <div id="payment-details-modal" class="overlay hidden">
    <div class="modal" style="max-width: 500px;">
      <div class="modal-header">
        <h3>–î–µ—Ç–∞–ª–∏ –ø–ª–∞—Ç–µ–∂–∞</h3>
        <button id="payment-details-close-btn" class="close-btn">&times;</button>
      </div>
      <div class="modal-body">
        <div id="payment-details-content"></div>
      </div>
    </div>
  </div>

  <!-- –ù–û–í–´–ô –ë–õ–û–ö 1: –°–ø–∏—Å–æ–∫ —Ç–∞—Ä–∏—Ñ–æ–≤ (–∫–∞–∫ —É –∫–ª–∏–µ–Ω—Ç–∞) -->
  <div id="client-view-tariff-list-modal" class="modal-overlay hidden">
    <div class="modal-content">
      <button class="modal-close" id="client-view-tariff-list-close-btn">&times;</button>
      <h2>–¢–∞—Ä–∏—Ñ—ã (–≤–∏–¥ –∫–ª–∏–µ–Ω—Ç–∞)</h2>
      <div class="bike-list" id="client-view-tariff-list-container">
        <!-- –°—é–¥–∞ –±—É–¥—É—Ç –≥—Ä—É–∑–∏—Ç—å—Å—è —Ç–∞—Ä–∏—Ñ—ã -->
      </div>
    </div>
  </div>

  <!-- –ù–û–í–´–ô –ë–õ–û–ö 2: –î–µ—Ç–∞–ª–∏ —Ç–∞—Ä–∏—Ñ–∞ (–∫–∞–∫ —É –∫–ª–∏–µ–Ω—Ç–∞) -->
  <div id="client-view-tariff-detail-modal" class="modal-overlay hidden">
    <div class="modal-content">
      <button class="modal-close" id="client-view-tariff-detail-close-btn">&times;</button>
      <h2 id="client-view-tariff-detail-title"></h2>
      <p id="client-view-tariff-detail-description" class="tariff-description"></p>
      <div class="tariff-options-list" id="client-view-tariff-options-list">
        <!-- –°—é–¥–∞ –±—É–¥—É—Ç –≥—Ä—É–∑–∏—Ç—å—Å—è –≤–∞—Ä–∏–∞–Ω—Ç—ã -->
      </div>
      <!-- –ö–Ω–æ–ø–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞, —Ç.–∫. —ç—Ç–æ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä -->
      <button class="btn btn-primary" disabled>–í—ã–±—Ä–∞—Ç—å —Ç–∞—Ä–∏—Ñ</button>
    </div>
  </div>

  <!-- Modal for adding tag -->
  <div id="add-tag-modal" class="overlay hidden">
    <div class="modal" style="max-width: 400px;">
      <div class="modal-header">
        <h3>–î–æ–±–∞–≤–∏—Ç—å —Ç–µ–≥</h3>
        <button id="add-tag-modal-close" class="close-btn">&times;</button>
      </div>
      <div class="modal-body">
        <form id="add-tag-form">
          <div class="form-group">
            <label for="new-tag-input">–¢–µ–≥</label>
            <input type="text" id="new-tag-input" class="modal-form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–≥" required>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" id="add-tag-modal-submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <!-- Modal for adding note -->
  <div id="add-note-modal" class="overlay hidden">
    <div class="modal" style="max-width: 400px;">
      <div class="modal-header">
        <h3>–î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É</h3>
        <button id="add-note-modal-close" class="close-btn">&times;</button>
      </div>
      <div class="modal-body">
        <form id="add-note-form">
          <div class="form-group">
            <label for="new-note-input">–ó–∞–º–µ—Ç–∫–∞</label>
            <textarea id="new-note-input" class="modal-form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–º–µ—Ç–∫—É" rows="3"
              required></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" id="add-note-modal-submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <!-- –ù–û–í–û–ï –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û: –í—ã–±–æ—Ä –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä–æ–≤ –¥–ª—è –∞—Ä–µ–Ω–¥—ã -->
  <div id="assign-batteries-modal" class="overlay hidden">
    <div class="modal" style="max-width: 550px;">
      <div class="modal-header">
        <h3>–í—ã–±–µ—Ä–∏—Ç–µ –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä—ã –¥–ª—è –∞—Ä–µ–Ω–¥—ã</h3>
        <button id="assign-batteries-cancel-btn" class="close-btn">&times;</button>
      </div>
      <div class="modal-body">
        <form id="assign-batteries-form">
          <input type="hidden" id="assign-batteries-rental-id">
          <p>–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä–æ–≤:</p>
          <!-- –í–û–¢ –°–Æ–î–ê –í–°–¢–ê–í–¨ –ü–û–ò–°–ö -->
          <div class="form-group" style="margin-bottom: 15px;">
            <input type="search" id="battery-search-in-modal" class="form-control" placeholder="–ü–æ–∏—Å–∫ –ø–æ —Å–µ—Ä–∏–π–Ω–æ–º—É –Ω–æ–º–µ—Ä—É...">
          </div>
          <div id="battery-select-list"
            style="max-height: 400px; overflow-y: auto; border: 1px solid var(--border); border-radius: 12px; padding: 10px;">
            <!-- –°–ø–∏—Å–æ–∫ –ê–ö–ë –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω —Å—é–¥–∞ —á–µ—Ä–µ–∑ JS -->
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" id="assign-batteries-submit-btn" class="btn btn-primary">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∏
          –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
      </div>
    </div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
<div id="booking-cost-modal" class="overlay hidden">
  <div class="modal" style="max-width: 420px;">
    <div class="modal-header">
      <h3>–°—Ç–æ–∏–º–æ—Å—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
      <button id="booking-cost-cancel-btn" class="close-btn">&times;</button>
    </div>
    <div class="modal-body">
      <form id="booking-cost-form">
        <div class="form-group">
          <label for="booking-cost-input">–¶–µ–Ω–∞ –∑–∞ 2 —á–∞—Å–∞ –±—Ä–æ–Ω–∏ (‚ÇΩ)</label>
          <input type="number" id="booking-cost-input" class="modal-form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 100" required>
          <p class="form-hint" style="font-size: 0.8rem; color: #6b6b6b; margin-top: 5px;">–≠—Ç–∞ —Å—É–º–º–∞ –±—É–¥–µ—Ç —Å–ø–∏—Å–∞–Ω–∞ —Å –∫–ª–∏–µ–Ω—Ç–∞ –∏ –∑–∞—á–∏—Å–ª–µ–Ω–∞ –Ω–∞ –µ–≥–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –±–∞–ª–∞–Ω—Å. –ï—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å 0, –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±—É–¥–µ—Ç –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º.</p>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button type="button" id="booking-cost-save-btn" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
  </div>
</div>

</body>

</html>